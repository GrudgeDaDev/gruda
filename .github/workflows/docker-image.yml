- name: Log in to GitHub Container Registry
  uses: docker/login-action@v3
  with:
    registry: ghcr.io
    username: ${{ github.actor }}
    password: ${{ secrets.GITHUB_TOKEN }}

- name: Build and push Docker image
  uses: docker/build-push-action@v6
  with:
    context: .
    file: ./Dockerfile
    push: ${{ github.event_name == 'release' }}
    tags: |
      ghcr.io/${{ github.repository }}/grudge-codex-backend:latest
      ghcr.io/${{ github.repository }}/grudge-codex-backend:${{ github.sha }}
